# DockerFile自定义镜像

## 镜像结构

镜像就是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。

镜像中应用程序的依赖是有层级关系的，通过将镜像结构的关系进行分层，在每一层的基础上添加安装包、依赖、配置等，然后形成新的一层。

下面一个MySQL5.7的镜像结构为例：

![image-20230715122924284](E:\学习笔记\Docker学习\img\image-20230715122924284.png)

镜像是分层结构，每一层都成为一个Layer。最底层的镜像是所依赖的操作系统生成的镜像，然后逐层上升，直到镜像运行入口处，入口处包含了镜像启动程序的启动脚本和参数。

## DockerFile

DockerFile就是一个文本文件，其中包含了一个个的指令，用指令来说明执行什么操作来构建镜像，每一层指令都会形成一层Layer。

1. FROM：指定基础镜像，表示构建新镜像时使用的基础操作系统或者是基于别人已经做好的镜像。 `FROM centos:6`  `FROM java:8-alpine`
2. RUN：在容器中执行命令，可以用于安装软件包、运行脚本或执行其他命令。 `RUN ym install gcc`
3. COPY/ADD：将文件或目录从构建环境复制到容器中。COPY 可以用于复制本地文件，ADD 更为灵活，支持复制本地文件、远程文件以及自动解压文件。`COPY ./mysql-5.7.rpm /tmp`
4. WORKDIR：设置容器中的工作目录，后续的指令执行都在该目录下。
5. ENV：设置环境变量，可以在容器内部使用,是给镜像使用者用的。`ENV KEY VALUE`
6. EXPOSE：声明容器的端口，但并不会自动映射主机端口。`EXPOSE 8080`
7. CMD：指定容器启动时要运行的命令，只能有一个 CMD，如果在 Dockerfile 中指定了多个 CMD，则只有最后一个会生效。
8. ENTRYPOINT：配置容器的入口点，用于指定容器启动时要调用的可执行文件或命令，可以结合 CMD 使用。`ENTRYPOINT java -jar xx.jar`
9. VOLUME：声明持久化存储的挂载点，可以将主机文件系统或其他容器的数据卷挂载到容器内部。

 最后在DockerFile文件构建好后，使用`docker build`命令根据dockerfile构建一个docker镜像