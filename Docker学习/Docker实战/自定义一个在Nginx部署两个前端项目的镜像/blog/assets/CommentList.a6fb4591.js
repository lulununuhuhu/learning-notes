import{d as H,r as R,L as N,x as E,W as U,h as s,o as l,c as u,b as t,t as h,z as $,F as P,g as O,N as V,i as Q,u as Y,n as Z,p as ee,U as ne,O as oe,D as le,$ as ie,e as x,a0 as G,a1 as W,a2 as ue,w as re,j as ce,f as z,y as de,a3 as pe,A as X,a4 as J,X as K,I as me,_ as _e,B as ve,C as ye}from"./index.e34733fd.js";import{a as ge,b as fe,l as he,c as j}from"./index.aed2b079.js";const Ce={class:"view-more-pagination"},ke={class:"pagination-page-count"},be=["onClick"],Be=H({__name:"Paging",props:{total:{type:Number,default:0},index:{type:Number},commentId:{type:Number}},emits:["getCurrentPage"],setup(v,{expose:T,emit:w}){const d=v,a=R(1),C=R(5),k=R(!1),i=N(()=>Math.ceil(d.total/C.value)),L=N(()=>i.value<=5?i.value:a.value<=4?[1,2,3,4,5,"...",i.value]:a.value>=i.value-4?[1,"...",i.value-5,i.value-4,i.value-3,i.value-2,i.value-1,i.value]:[1,"...",a.value-2,a.value-1,a.value,a.value+1,a.value+2,"...",i.value]),B=()=>{a.value-=1,w("getCurrentPage",a.value,d.index,d.commentId)},g=m=>{a.value=m,w("getCurrentPage",m,d.index,d.commentId)},b=()=>{a.value+=1,w("getCurrentPage",a.value,d.index,d.commentId)};return T({current:a,setPaging:m=>{k.value=m}}),(m,p)=>E((l(),u("div",Ce,[t("span",ke,"\u5171"+h(s(i))+"\u9875",1),s(a)!==1?(l(),u("span",{key:0,class:"pagination-btn",onClick:B},"\u4E0A\u4E00\u9875")):$("",!0),(l(!0),u(P,null,O(s(L),(f,A)=>(l(),u(P,null,[typeof f=="number"?(l(),u("span",{key:A,onClick:M=>g(f),class:V(["pagination-page-number",s(a)==f?"current-page":""])},h(f),11,be)):(l(),u("span",{class:"pagination-page-do",key:f},"..."))],64))),256)),s(a)!==s(i)?(l(),u("span",{key:1,class:"pagination-btn",onClick:b},"\u4E0B\u4E00\u9875")):$("",!0)],512)),[[U,s(k)]])}});const xe=Q(Be,[["__scopeId","data-v-13277137"]]),we={key:0,class:"reply-box"},Le={class:"box-normal"},$e={class:"reply-box-avatar"},Ie=["src"],Re=["src"],Te={class:"reply-box-warp"},Ae=["onInput","placeholder"],Fe={class:"box-expand"},De=H({__name:"ReplyBox",props:{commentType:{type:Number},show:{type:Boolean,default:!0},typeId:{type:Number}},emits:["reload"],setup(v,{expose:T,emit:w}){const d=v,{user:a,blog:C,app:k}=Y(),i={lineHeight:"normal",borderColor:"#ed6ea0",backgroundColor:"var(--grey-0)"},L=Z({nickname:"",sendActive:!1,show:d.show,commentContent:"",emojiType:0,commentForm:{typeId:d.typeId,commentType:d.commentType,parentId:void 0,replyId:void 0,toUid:void 0,commentContent:""}}),{nickname:B,sendActive:g,show:b,commentContent:_,emojiType:m,commentForm:p}=ee(L),f=N(()=>B.value?`\u56DE\u590D @${B.value}\uFF1A`:"\u53D1\u4E00\u6761\u53CB\u5584\u7684\u8BC4\u8BBA"),A=()=>{_.value.length==0?g.value=!1:g.value=!0},M=y=>{_.value+=y,g.value=!0},S=y=>{m.value=y},F=()=>{var y;if(!a.id){k.setLoginFlag(!0);return}if(_.value.trim()==""){(y=window.$message)==null||y.error("\u8BC4\u8BBA\u4E0D\u80FD\u4E3A\u7A7A");return}p.value.commentContent=_.value.replace(/\[.+?\]/g,e=>m.value===0?G[e]===void 0?e:"<img src= '"+G[e]+"' width='21' height='21' style='margin: 0 1px;vertical-align: text-bottom'/>":m.value===1?W[e]===void 0?e:"<img src= '"+W[e]+"' width='21' height='21' style='margin: 0 1px;vertical-align: text-bottom'/>":e),ge(p.value).then(({data:e})=>{var o,n;e.flag&&(g.value=!1,_.value="",C.blogInfo.siteConfig.commentCheck?(o=window.$message)==null||o.warning("\u8BC4\u8BBA\u6210\u529F\uFF0C\u6B63\u5728\u5BA1\u6838\u4E2D"):(n=window.$message)==null||n.success("\u8BC4\u8BBA\u6210\u529F"),w("reload"))})};return T({commentForm:p,nickname:B,setReply:y=>{b.value=y}}),(y,e)=>{const o=ue;return s(b)?(l(),u("div",we,[t("div",Le,[t("div",$e,[s(a).avatar?(l(),u("img",{key:0,class:"shoka-avatar",src:s(a).avatar,alt:""},null,8,Ie)):(l(),u("img",{key:1,class:"shoka-avatar",src:s(C).blogInfo.siteConfig.touristAvatar,alt:""},null,8,Re))]),t("div",Te,[E(t("textarea",{class:"reply-box-textarea","onUpdate:modelValue":e[0]||(e[0]=n=>oe(_)?_.value=n:null),style:le(s(g)?i:""),onInput:ie(A,["prevent"]),placeholder:s(f)},null,44,Ae),[[ne,s(_)]])]),t("div",{class:V(["reply-box-send",s(g)?"send-active":""]),onClick:F}," \u8BC4\u8BBA ",2)]),t("div",Fe,[x(o,{onAddEmoji:M,onChooseType:S})])])):$("",!0)}}}),Ee=v=>(ve("data-v-d5f1793f"),v=v(),ye(),v),Pe={class:"reply-warp",id:"reply-wrap"},Ne={class:"reply-title"},Me={key:0},Se={class:"reply-box-avatar"},ze=["src"],Ue={class:"content-warp"},Ve={class:"user-info"},je={class:"user-name"},Oe=["innerHTML"],He={class:"reply-info"},qe={class:"reply-time"},Ge=["onClick"],We=["onClick"],Xe={class:"sub-user-info"},Je=["src"],Ke={class:"sub-user-name"},Qe={class:"reply-content"},Ye={style:{color:"#008ac5"}},Ze=["innerHTML"],et={class:"reply-info"},tt={class:"reply-time"},st=["onClick"],at=["onClick"],nt=["onClick"],ot=Ee(()=>t("div",{class:"bottom-line"},null,-1)),lt={key:0,class:"loading-warp"},it={key:1,style:{padding:"1.25rem","text-align":"center"}},ut=H({__name:"CommentList",props:{commentType:{type:Number}},emits:["getCommentCount"],setup(v,{emit:T}){const w=v,{user:d,app:a}=Y(),C=R([]),k=R([]),i=R([]),L=N(()=>Number(K().params.id)?Number(K().params.id):void 0),B=N(()=>e=>d.commentLikeSet.indexOf(e)!=-1?"like-flag":""),g=Z({count:0,reFresh:!0,queryParams:{current:1,typeId:L.value,commentType:w.commentType},commentList:[]}),{count:b,reFresh:_,queryParams:m,commentList:p}=ee(g),f=e=>{if(!d.id){a.setLoginFlag(!0);return}let o=e.id;he(o).then(({data:n})=>{n.flag&&(d.commentLikeSet.indexOf(o)!=-1?e.likeCount-=1:e.likeCount+=1,d.commentLike(o))})};re(p,()=>{_.value=!1,me(()=>{_.value=!0})},{deep:!1});const A=(e,o)=>{j(o.id,{current:1,size:5}).then(({data:n})=>{o.replyVOList=n.data,o.replyCount>5&&k.value[e].setPaging(!0),i.value[e].style.display="none"})},M=(e,o,n)=>{j(n,{current:e,size:5}).then(({data:I})=>{p.value[o].replyVOList=I.data})},S=(e,o)=>{C.value.forEach(I=>{I.setReply(!1)});const n=C.value[e];n.nickname=o.fromNickname,n.commentForm.replyId=o.id,n.commentForm.toUid=o.fromUid,n.commentForm.parentId=p.value[e].id,n.setReply(!0)},F=()=>{fe(m.value).then(({data:e})=>{m.value.current==1?p.value=e.data.recordList:p.value.push(...e.data.recordList),m.value.current++,b.value=e.data.count,T("getCommentCount",b.value)})},q=()=>{m.value.current=1,F()},y=e=>{j(p.value[e].id,{current:k.value[e].current,size:5}).then(({data:o})=>{p.value[e].replyVOList=o.data,p.value[e].replyCount++,C.value[e].setReply(!1),p.value[e].replyCount>5&&k.value[e].setPaging(!0),i.value[e].style.display="none"})};return ce(()=>{F()}),(e,o)=>{const n=_e,I=De,te=xe,se=pe;return l(),u("div",Pe,[t("div",Ne,[x(n,{"icon-class":"comment",size:"1.4rem",style:{"margin-right":"5px"}}),z(" \u8BC4\u8BBA ")]),x(I,{onReload:q,"comment-type":v.commentType,"type-id":s(L)},null,8,["comment-type","type-id"]),s(b)>0&&s(_)?(l(),u("div",Me,[(l(!0),u(P,null,O(s(p),(c,D)=>(l(),u("div",{class:"reply-item",key:c.id},[t("div",Se,[t("img",{class:"shoka-avatar",src:c.avatar},null,8,ze)]),t("div",Ue,[t("div",Ve,[t("div",je,h(c.fromNickname),1),c.fromUid==1?(l(),X(n,{key:0,"icon-class":"badge"})):$("",!0)]),t("div",{class:"reply-content",innerHTML:c.commentContent},null,8,Oe),t("div",He,[t("span",qe,h(s(J)(c.createTime)),1),t("span",{class:"reply-like",onClick:r=>f(c)},[x(n,{class:V(["like",s(B)(c.id)]),"icon-class":"like",size:"0.8rem",style:{"margin-right":"5px"}},null,8,["class"]),E(t("span",null,h(c.likeCount),513),[[U,c.likeCount]])],8,Ge),t("span",{class:"reply-btn",onClick:r=>S(D,c)},"\u56DE\u590D",8,We)]),(l(!0),u(P,null,O(c.replyVOList,r=>(l(),u("div",{class:"sub-reply-item",key:r.id},[t("div",Xe,[t("img",{class:"sub-reply-avatar",src:r.avatar},null,8,Je),t("div",Ke,h(r.fromNickname),1),r.fromUid==1?(l(),X(n,{key:0,"icon-class":"badge",style:{"margin-left":"5px"}})):$("",!0)]),t("span",Qe,[r.fromUid!==r.toUid?(l(),u(P,{key:0},[z("\u56DE\u590D "),t("span",Ye,"@"+h(r.toNickname),1),z(" :")],64)):$("",!0),t("span",{innerHTML:r.commentContent},null,8,Ze)]),t("div",et,[t("span",tt,h(s(J)(r.createTime)),1),t("span",{class:"reply-like",onClick:ae=>f(r)},[x(n,{class:V(["like",s(B)(r.id)]),"icon-class":"like",size:"0.8rem",style:{"margin-right":"5px"}},null,8,["class"]),E(t("span",null,h(r.likeCount),513),[[U,r.likeCount>0]])],8,st),t("span",{class:"reply-btn",onClick:ae=>S(D,r)},"\u56DE\u590D",8,at)])]))),128)),E(t("div",{ref_for:!0,ref_key:"readMoreRef",ref:i,class:"view-more"},[t("span",null,"\u5171"+h(c.replyCount)+"\u6761\u56DE\u590D, ",1),t("span",{class:"view-more-btn",onClick:r=>A(D,c)},"\u70B9\u51FB\u67E5\u770B",8,nt)],512),[[U,c.replyCount>3]]),x(te,{ref_for:!0,ref_key:"pageRef",ref:k,total:c.replyCount,index:D,commentId:c.id,onGetCurrentPage:M},null,8,["total","index","commentId"]),x(I,{ref_for:!0,ref_key:"replyRef",ref:C,class:"mt-4",show:!1,"comment-type":v.commentType,"type-id":s(L),onReload:r=>y(D)},null,8,["comment-type","type-id","onReload"]),ot])]))),128)),s(b)>s(p).length?(l(),u("div",lt,[x(se,{class:"btn",color:"#e9546b",onClick:F},{default:de(()=>[z(" \u52A0\u8F7D\u66F4\u591A... ")]),_:1})])):$("",!0)])):(l(),u("div",it,"\u6765\u53D1\u8BC4\u8BBA\u5427~"))])}}});const dt=Q(ut,[["__scopeId","data-v-d5f1793f"]]);export{dt as _};
