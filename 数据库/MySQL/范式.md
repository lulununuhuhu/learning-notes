# 范式

在我们设计数据库时，需要考虑的点有：

1. 保证数据字段的正确性，这就需要正确的约束类型定义
2. 保证数据表不冗余，在用户量增大的情况下数据库复杂度不会大幅增加，这就i需要降低数据表的数据冗余度

3. 保证数据库管理者能正确方便的使用数据库

## 范式简介

> 范式是在关系型数据库中，设计数据表所总结的一套设计原则和指导方法。

## 范式的种类

目前关系型数据库中有六种常见范式，按照范式级别，从低到高分别是：第一范式(1NF)、第二范式(2NF)、第三范式(3NF)、巴斯-科德范式(BCNF)、第四范式(4NF)、第五范式(5NF，又称完美范式)。

### 第一范式

要求数据表中的每个字段都具有**原子性**，不可拆分，这种原子性可以根据实际业务需求进行不同的定义。比如设计了一个字段叫详细信息（家庭住址、电话、联系方式），这就有可能不符合1NF，应该将详细信息拆成3个字段。

### 第二范式

在第一范式的基础上，要求**数据表中的任意一条数据记录都是可以用主键组唯一可标识的**，知道主键组的信息，就肯定可以找到一条数据记录。通过一个主键组确定一个非主键组的所有字段信息，那么可以说这个非主键组**完全依赖**于主键组；如果表中的非主属性不完全依赖于主键，那就不满足第二范式，会产生数据冗余，数据更新异常的情况。

例如成绩单表(学号，课程编号，成绩)中，一组[学号，课程编号]确定一个成绩，那么可以说成绩与[学号,课程编号]是完全依赖关系。

又例如比赛表中候选键和主键都为(球员编号,比赛编号)，通过候选键和主键可以决定如下关系：

(球员编号,比赛编号)→(姓名,年龄，比赛时间，比赛场地，得分),但上述关系并不是完全依赖关系，可以将其抽成

```
(球员编号)→(姓名,年龄)
(比赛编号)→(比赛时间,比赛场地)
(球员编号,比赛编号)→(得分)
```

将原本部分依赖的关系，分成三个完全依赖的主键和非主键关系，从而将原本一张表分解成三张表。

| 表名                        | 属性(字段)                  |
| --------------------------- | --------------------------- |
| 球员player表                | 球员编号，姓名，年龄        |
| 比赛game表                  | 比赛编号,比赛时间，比赛场地 |
| 球员比赛关系表player_game表 | 球员编号,比赛编号和得分     |

> 关于第二范式的总结：第二范式(2NF)要求实体的属性完全依赖于主关键字。如果存在不完全依赖，那么这个属性和主关键字的这一部分应该分离出来形成一个新表，新表与原表之间是一对多的关系。

### 第三范式

第三范式是在第二范式的基础上，确保数据表中的每一个非主键字段和主键组完全相关，要求**非主键字段不能和其他非主键字段有依赖关系，必须相互独立**。如果有依赖关系，则必须将有依赖关系的字段抽出来建立新表。

> 关于第三范式的总结：数据表中的所有非主键完全依赖于主键且只依赖主键。

## 案例：商超进货系统的进货单表

![image-20220525162846172](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525162846172.png)

进货单的所有信息中都在一张表中，出现了大量的冗余信息。

1. 根据第一范式，将属性可以再次分解成数量和单位

   ![image-20220525163255180](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525163255180.png)

2. 根据第二范式，找出依赖关系

   * (条码)→（名称，规格，单位）
   * (单号，供应商编号)→(供应商名称,仓库)

   从而可以将原表进行拆分为：

​	商品信息表

​	![image-20220525164501239](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525164501239.png)

​	进货单头表

​	![image-20220525164634019](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525164634019.png)

​	订单明细表
![image-20220525164700775](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525164700775.png)

3. 根据第三范式，将与主键间接依赖的非主键进行抽离出来

   * 进货单头表中，供应商名称直接依赖供应商编号,供应商编号依赖于单号(单号→供应商编号→供应商名称)

   所以可以在进货单头表中抽出一张进货商表

   ![image-20220525165739731](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525165739731.png)

​	进货单头表变为：

![image-20220525165839042](C:/Users/lucheng/AppData/Roaming/Typora/typora-user-images/image-20220525165839042.png)



**最终为了满足第三范式，将原本的一张表分解成了四张表，商品信息表，进货单头表，进货商表，订单明细表四张表。**

