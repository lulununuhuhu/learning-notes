## 数据定义语言DDL

> 数据定义语言DDL用来创建数据库中的各种对象---表、视图、索引、同义词、聚簇等。例如有：`CREATE DROP ALTER`。DDL语言的操作是隐性提交的，不能rollback。

## 创建和管理表

### 标识符命名规则

* 数据库名、表名、字段名等对象名字中间不要包含空格
* 同一个MySQL软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名
* 如果使用的数据库名、表名、字段名与系统关键字冲突，需用`''`括起来

### 创建和管理数据库

1. 创建数据库

   ```sql
   # 方式一:
   CREATE DATABASE dbtest1;
   # 方式二：显示的指明要实现的数据库的字符集
   CREATE DATABASE dbtest1 CHARACTER SET 'gbk';
   # 方式三：判断要创建的数据库是否已经创建
   CREATE DATABASE IF NOT EXISTS dbtest1 CHARACTER SET 'utf8';
   ```

2. 显示数据库

   ```sql
   SHOW DATABASES;
   ```

3. 查看创建的库的语句结构

   ```sql
   SHOW CREATE DATABASE dbtest1;
   ```

4. 显示数据库系统不同部分的字符集

   ```sql
   SHOW VARIABLES LIKE 'character_%';
   ```

5. 修改数据库

   ```sql
   #将dbtest1数据库字符集变为 gbk
   ALTER DATABASE dbtest1 CHARACTER SET 'gbk';
   ```

6. 删除数据库

   ```sql
   #方式一：
   DROP DATABASE dbtest1;
   #方式二（推荐）：
   DROP DATABASE IF EXISTS dbtest1;
   ```

### 创建表

方式一：

```sql
CREATE TABLE [IF NOT EXISTS] 表名
( 字段1, 数据类型 [约束条件] [默认值], 
 字段2, 数据类型 [约束条件] [默认值], 
 字段3, 数据类型 [约束条件] [默认值],
 ……[表约束条件] );
```

```sql
#例子
CREATE TABLE IF NOT EXISTS myEmpl(
id INT,
emp_name VARCHAR(15),
hire_date DATE
);

CREATE TABLE emp (
-- int类型 
    emp_id INT,
-- 最多保存20个中英文字符 
    emp_name VARCHAR(20),
-- 总位数不超过15位 
    salary DOUBLE,
-- 日期类型 
    birthday DATE 
);

CREATE TABLE dept(
-- int类型，自增 
    deptno INT(2) AUTO_INCREMENT, 
    dname VARCHAR(14), 
    loc VARCHAR(13),
-- 主键 
    PRIMARY KEY (deptno) 
);
```

方式二：基于现有表结构进行创建并导入数据

```sql
# 方式二 基于现有的表，结合SELECT语句返回的数据创建表并导入数据
CREATE TABLE IF NOT EXISTS myEmpl1
AS
SELECT employee_id,last_name,salary
FROM employees;
 # 基于现有表的情况下，可以基于现有表并且使用别名后更改字段名
CREATE TABLE IF NOT EXISTS myEmpl2
AS
SELECT employee_id 'id',last_name 'name',salary '薪资'
FROM employees
WHERE 1 = 2;#为了只得到表的结构，把所有数据过滤掉
```

查看数据表的结构：

```sql
SHOW CREATE TABLE myEmpl;#如果创建表时没有指定字符集则默认使用所在库的字符集
```

### 修改表

1. 添加一个字段

   ```sql
   ALTER TABLE myempl
   ADD salary DOUBLE(10,2);#10是DOUBLE字段总长度，2是小数点后的精度长度，默认的是添加到表的最后一个字段
   
   #在表首个字段添加phone_number属性
   ALTER TABLE myempl
   ADD phone_number VARCHAR(20) FIRST;
   
   # 在emp_name字段后面添加一个email字段
   ALTER TABLE myempl
   ADD email VARCHAR(45) AFTER emp_name;
   ```

2. 修改一个字段：数据类型、长度、默认值（略）

   ```sql
   ALTER TABLE myempl
   CHANGE salary salary_monthly  DOUBLE(10,2);#将字段名salary改为salary_monthly，类型为DOUBLE
   
   ALTER TABLE myempl
   CHANGE email my_email VARCHAR(50);#将字段名email改为my_email，类型为VARCHAR
   ```

3. 删除字段

   ```sql
   ALTER TABLE myempl
   DROP COLUMN my_email;
   ```

4. 重命名表

   ```sql
   #方式一 
   RENAME TABLE myempl
   TO myempll;
   
   #方式二
   ALTER TABLE myempl2
   RENAME TO myemp2;
   ```

5. 删除表

   * 当一张数据表没有和其他表形成关联关系时，就可以删除这张表

   ```sql
   DROP TABLE IF EXISTS 表名1,表名2;
   ```

6. 清空表

   * 删除表中所有的数据
   * 释放表的存储空间
   * TRUNCATE语句**不能回滚**，而使用DELETE语句删除数据可以回滚

   ```sql
   TRUNCATE TABLE 表名1,表名2;
   ```


## DCL中的COMMIT和ROLLBACK

> COMMIT:提交数据，一旦执行了COMMIT，则数据就永久的保存在了数据库中，意味着不可以回滚撤销
>
> ROLLBACK:回滚数据，执行ROLLBACK，则可以回到**上一次COMMIT之后**的初始状态

### 关于DDL和DML的事务控制上的说明

DDL类型的SQL语句，操作一旦执行完毕，就无法回滚，不受set autocommit = true的影响；而DML的操作默认情况下，也是自动提交的（autocommit = fasle）;如需回滚，需要SET autocommit = FALSE。

